#!/bin/bash
set -euo pipefail

NAMESPACE=${INGRESS_NAMESPACE:-ingress-nginx}

echo "Creating namespace $NAMESPACE if it doesn't exist..."
kubectl create namespace "$NAMESPACE" --dry-run=client -o yaml | kubectl apply -f -

echo "Adding ingress-nginx Helm repo..."
helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx
helm repo update

echo "Installing ingress-nginx via Helm..."
helm upgrade --install ingress-nginx ingress-nginx/ingress-nginx \
  --namespace "$NAMESPACE" \
  --set controller.publishService.enabled=true

echo "Ingress controller installation complete."